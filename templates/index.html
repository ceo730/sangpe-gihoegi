<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìƒí˜ê¸°íšê¸° â€” ì „í™˜ìœ¨ ì¤‘ì‹¬ ìƒì„¸í˜ì´ì§€ ë¶„ì„</title>
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #232733;
    --border: #2e3345;
    --text: #e4e6ef;
    --text-dim: #8b8fa3;
    --accent: #6c63ff;
    --accent-glow: rgba(108,99,255,.25);
    --red: #ff6b6b;
    --orange: #ffa94d;
    --green: #51cf66;
    --blue: #339af0;
    --purple: #845ef7;
    --teal: #20c997;
    --pink: #f06595;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* â”€â”€ Header â”€â”€ */
  .header {
    border-bottom: 1px solid var(--border);
    padding: 1.25rem 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    backdrop-filter: blur(10px);
    position: sticky; top: 0; z-index: 100;
    background: rgba(15,17,23,.85);
  }
  .header h1 { font-size: 1.25rem; font-weight: 700; }
  .header h1 span { color: var(--accent); }
  .header .badge {
    font-size: .7rem;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: .2rem .7rem;
    color: var(--text-dim);
  }

  /* â”€â”€ Layout â”€â”€ */
  .container { max-width: 1100px; margin: 0 auto; padding: 2rem 1.5rem; }

  /* â”€â”€ Upload Area â”€â”€ */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: 16px;
    padding: 3rem 2rem;
    text-align: center;
    cursor: pointer;
    transition: all .2s;
    background: var(--surface);
    position: relative;
  }
  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--accent);
    background: rgba(108,99,255,.05);
    box-shadow: 0 0 30px var(--accent-glow);
  }
  .upload-zone input { display: none; }
  .upload-zone .icon { font-size: 2.5rem; margin-bottom: .75rem; }
  .upload-zone p { color: var(--text-dim); font-size: .9rem; }
  .upload-zone .hint { font-size: .8rem; color: var(--text-dim); margin-top: .5rem; opacity: .7; }

  /* â”€â”€ Preview â”€â”€ */
  .preview-grid {
    display: flex;
    gap: .75rem;
    flex-wrap: wrap;
    margin-top: 1.25rem;
  }
  .preview-item {
    position: relative;
    width: 120px; height: 120px;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid var(--border);
  }
  .preview-item img { width: 100%; height: 100%; object-fit: cover; }
  .preview-item .remove {
    position: absolute; top: 4px; right: 4px;
    background: rgba(0,0,0,.7); color: #fff;
    border: none; border-radius: 50%;
    width: 22px; height: 22px; cursor: pointer;
    font-size: .75rem; display: flex; align-items: center; justify-content: center;
  }

  /* â”€â”€ Button â”€â”€ */
  .btn-analyze {
    padding: .75rem 2rem;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all .2s;
    margin-top: 1.5rem;
    width: 100%;
  }
  .btn-analyze:hover { box-shadow: 0 4px 20px var(--accent-glow); transform: translateY(-1px); }
  .btn-analyze:disabled { opacity: .4; cursor: not-allowed; transform: none; box-shadow: none; }

  /* â”€â”€ Spinner â”€â”€ */
  .spinner-wrap {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 3rem 0;
  }
  .spinner-wrap.show { display: flex; }
  .spinner {
    width: 48px; height: 48px;
    border: 4px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin .8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner-wrap p { color: var(--text-dim); font-size: .95rem; }

  /* â”€â”€ Error â”€â”€ */
  .error-box {
    background: rgba(255,107,107,.1);
    border: 1px solid var(--red);
    border-radius: 10px;
    padding: 1rem 1.25rem;
    color: var(--red);
    margin-top: 1.5rem;
    display: none;
  }
  .error-box.show { display: block; }

  /* â”€â”€ Results â”€â”€ */
  #results { display: none; margin-top: 2.5rem; }
  #results.show { display: block; }

  .section-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 2rem 0 1rem;
    display: flex;
    align-items: center;
    gap: .5rem;
  }
  .section-title::before {
    content: '';
    width: 4px; height: 1.1rem;
    background: var(--accent);
    border-radius: 2px;
  }

  /* â”€â”€ Metric Cards â”€â”€ */
  .metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: .75rem;
  }
  .metric-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem;
  }
  .metric-card .label { font-size: .75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: .05em; margin-bottom: .35rem; }
  .metric-card .value { font-size: 1.05rem; font-weight: 600; }

  /* â”€â”€ Section Cards â”€â”€ */
  .section-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
    margin-bottom: .75rem;
    position: relative;
    overflow: hidden;
  }
  .section-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 4px;
  }
  .section-card .card-head {
    display: flex;
    align-items: center;
    gap: .6rem;
    margin-bottom: .75rem;
  }
  .section-card .order-badge {
    width: 28px; height: 28px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: .8rem; font-weight: 700;
    color: #fff;
    flex-shrink: 0;
  }
  .section-card .role-name { font-weight: 700; font-size: 1rem; }
  .section-card .detail { margin-top: .4rem; font-size: .88rem; color: var(--text-dim); }
  .section-card .detail strong { color: var(--text); font-weight: 600; }

  /* â”€â”€ Structure Summary â”€â”€ */
  .summary-box {
    background: linear-gradient(135deg, rgba(108,99,255,.1), rgba(51,154,240,.1));
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
    font-size: .95rem;
    line-height: 1.7;
  }

  /* â”€â”€ Strengths / Weaknesses â”€â”€ */
  .sw-grid { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }
  @media (max-width: 700px) { .sw-grid { grid-template-columns: 1fr; } }
  .sw-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem;
  }
  .sw-box h4 { margin-bottom: .75rem; font-size: .95rem; }
  .sw-box ul { list-style: none; }
  .sw-box ul li {
    padding: .4rem 0;
    font-size: .9rem;
    color: var(--text-dim);
    display: flex;
    align-items: flex-start;
    gap: .5rem;
  }
  .sw-box ul li::before { flex-shrink: 0; margin-top: 2px; }
  .sw-box.strengths ul li::before { content: 'âœ…'; }
  .sw-box.weaknesses ul li::before { content: 'âš ï¸'; }

  /* â”€â”€ Improvements â”€â”€ */
  .improve-list { list-style: none; counter-reset: imp; }
  .improve-list li {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: .85rem 1.25rem;
    margin-bottom: .5rem;
    font-size: .9rem;
    display: flex;
    align-items: flex-start;
    gap: .75rem;
  }
  .improve-list li::before {
    counter-increment: imp;
    content: counter(imp);
    width: 26px; height: 26px;
    background: var(--accent);
    color: #fff;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: .75rem; font-weight: 700;
    flex-shrink: 0;
  }

  /* â”€â”€ Download â”€â”€ */
  .btn-download {
    display: inline-flex;
    align-items: center;
    gap: .5rem;
    padding: .65rem 1.5rem;
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 10px;
    font-size: .9rem;
    cursor: pointer;
    transition: all .2s;
    text-decoration: none;
    margin-top: 1rem;
  }
  .btn-download:hover { border-color: var(--accent); background: rgba(108,99,255,.1); }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <h1><span>ìƒí˜</span>ê¸°íšê¸°</h1>
  <span class="badge">ì „í™˜ìœ¨ ë¶„ì„ ì—”ì§„ v1.0</span>
</div>

<div class="container">

  <!-- Upload Zone -->
  <div class="upload-zone" id="uploadZone">
    <div class="icon">ğŸ“„</div>
    <p><strong>ìƒì„¸í˜ì´ì§€ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</strong></p>
    <p class="hint">JPG, PNG, WEBP ì§€ì› Â· ë³µìˆ˜ ì´ë¯¸ì§€ ê°€ëŠ¥ Â· ìœ„â†’ì•„ë˜ ìˆœì„œëŒ€ë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
    <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.webp" multiple>
  </div>
  <div class="preview-grid" id="previewGrid"></div>

  <!-- Analyze Button -->
  <button class="btn-analyze" id="btnAnalyze" disabled>ë¶„ì„ ì‹œì‘</button>

  <!-- Spinner -->
  <div class="spinner-wrap" id="spinner">
    <div class="spinner"></div>
    <p>Claudeê°€ ìƒì„¸í˜ì´ì§€ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤â€¦</p>
  </div>

  <!-- Error -->
  <div class="error-box" id="errorBox"></div>

  <!-- Results -->
  <div id="results">
    <div class="section-title">ê¸°ë³¸ ì •ë³´</div>
    <div class="metric-grid" id="metricGrid"></div>

    <div class="section-title">í•µì‹¬ ì¹´í”¼</div>
    <div id="keyCopyWrap"></div>

    <div class="section-title">ì„¹ì…˜ë³„ ì„¤ë“ êµ¬ì¡°</div>
    <div id="sectionsWrap"></div>

    <div class="section-title">ì „ì²´ êµ¬ì¡° ìš”ì•½</div>
    <div class="summary-box" id="summaryBox"></div>

    <div class="section-title">ê°•ì  / ì•½ì </div>
    <div class="sw-grid" id="swGrid"></div>

    <div class="section-title">ì „í™˜ìœ¨ ê°œì„  í¬ì¸íŠ¸</div>
    <ol class="improve-list" id="improveList"></ol>

    <a class="btn-download" id="btnDownload" download="analysis_result.json" style="margin-top:1.5rem">â¬‡ JSON ì›ë³¸ ë‹¤ìš´ë¡œë“œ</a>
  </div>

</div>

<script>
const ROLE_COLORS = {
  'ê°ì •ê³µê°': '#ff6b6b',
  'ë¬¸ì œì œê¸°': '#ffa94d',
  'í•´ê²°ì œì‹œ': '#51cf66',
  'ì°¨ë³„í™”': '#339af0',
  'ì¦ê±°': '#845ef7',
  'ì‹ ë¢°': '#20c997',
  'CTA': '#f06595'
};

const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');
const previewGrid = document.getElementById('previewGrid');
const btnAnalyze = document.getElementById('btnAnalyze');
const spinner = document.getElementById('spinner');
const errorBox = document.getElementById('errorBox');
const results = document.getElementById('results');

let selectedFiles = [];

// â”€â”€ Upload handling â”€â”€
uploadZone.addEventListener('click', () => fileInput.click());
uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
uploadZone.addEventListener('drop', e => {
  e.preventDefault();
  uploadZone.classList.remove('dragover');
  addFiles(e.dataTransfer.files);
});
fileInput.addEventListener('change', () => addFiles(fileInput.files));

function addFiles(fileList) {
  for (const f of fileList) {
    if (/\.(jpe?g|png|webp)$/i.test(f.name)) selectedFiles.push(f);
  }
  renderPreviews();
}

function renderPreviews() {
  previewGrid.innerHTML = '';
  selectedFiles.forEach((f, i) => {
    const div = document.createElement('div');
    div.className = 'preview-item';
    const img = document.createElement('img');
    img.src = URL.createObjectURL(f);
    const btn = document.createElement('button');
    btn.className = 'remove';
    btn.textContent = 'âœ•';
    btn.onclick = () => { selectedFiles.splice(i, 1); renderPreviews(); };
    div.append(img, btn);
    previewGrid.appendChild(div);
  });
  btnAnalyze.disabled = selectedFiles.length === 0;
}

// â”€â”€ Analyze â”€â”€
btnAnalyze.addEventListener('click', async () => {
  if (selectedFiles.length === 0) return;

  errorBox.classList.remove('show');
  results.classList.remove('show');
  spinner.classList.add('show');
  btnAnalyze.disabled = true;

  const formData = new FormData();
  selectedFiles.forEach(f => formData.append('images', f));

  try {
    const resp = await fetch('/analyze', { method: 'POST', body: formData });
    const data = await resp.json();
    if (!resp.ok) throw new Error(data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
    renderResults(data);
  } catch (err) {
    errorBox.textContent = err.message;
    errorBox.classList.add('show');
  } finally {
    spinner.classList.remove('show');
    btnAnalyze.disabled = false;
  }
});

// â”€â”€ Render Results â”€â”€
function renderResults(data) {
  // Metrics
  const metricGrid = document.getElementById('metricGrid');
  metricGrid.innerHTML = [
    { label: 'ìƒí’ˆëª…', value: data.product_name },
    { label: 'ë¸Œëœë“œ', value: data.brand_name },
    { label: 'ì¹´í…Œê³ ë¦¬', value: data.category },
    { label: 'íƒ€ê²Ÿ ê³ ê°', value: data.estimated_target },
    { label: 'ê°€ê²©ëŒ€', value: data.price_range },
  ].map(m => `<div class="metric-card"><div class="label">${m.label}</div><div class="value">${m.value || '-'}</div></div>`).join('');

  // Key Copy
  const keyCopyWrap = document.getElementById('keyCopyWrap');
  const copies = data.key_copy_text || [];
  keyCopyWrap.innerHTML = copies.length
    ? copies.map(c => `<div class="summary-box" style="margin-bottom:.5rem;font-style:italic">"${c}"</div>`).join('')
    : '<div class="summary-box">-</div>';

  // Sections
  const sectionsWrap = document.getElementById('sectionsWrap');
  sectionsWrap.innerHTML = (data.sections || []).map(sec => {
    const color = ROLE_COLORS[sec.role] || '#868e96';
    return `<div class="section-card" style="border-left:4px solid ${color}">
      <div class="card-head">
        <div class="order-badge" style="background:${color}">${sec.order}</div>
        <div class="role-name" style="color:${color}">${sec.role}</div>
      </div>
      <div class="detail"><strong>ì‹œê° êµ¬ì„±:</strong> ${sec.image_description || '-'}</div>
      <div class="detail"><strong>ì¹´í”¼ ìš”ì•½:</strong> ${sec.copy_summary || '-'}</div>
      <div class="detail"><strong>ì„¤ë“ ì˜ë„:</strong> ${sec.persuasion_intent || '-'}</div>
      <div class="detail"><strong>ì‹¬ë¦¬ ê¸°ë²•:</strong> ${sec.psychology_used || '-'}</div>
    </div>`;
  }).join('');

  // Summary
  document.getElementById('summaryBox').textContent = data.overall_structure || '-';

  // Strengths / Weaknesses
  const swGrid = document.getElementById('swGrid');
  swGrid.innerHTML = `
    <div class="sw-box strengths"><h4>âœ… ê°•ì </h4><ul>${(data.strengths || []).map(s => `<li>${s}</li>`).join('')}</ul></div>
    <div class="sw-box weaknesses"><h4>âš ï¸ ì•½ì </h4><ul>${(data.weaknesses || []).map(w => `<li>${w}</li>`).join('')}</ul></div>
  `;

  // Improvements
  const improveList = document.getElementById('improveList');
  improveList.innerHTML = (data.conversion_improvement_points || []).map(p => `<li><span>${p}</span></li>`).join('');

  // Download
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  document.getElementById('btnDownload').href = URL.createObjectURL(blob);

  results.classList.add('show');
}
</script>
</body>
</html>
